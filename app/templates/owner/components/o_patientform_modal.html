<div class="modal fade" id="patientinfoModal" tabindex="-1" aria-labelledby="patientinfoModalLabel" aria-hidden="true">
    <style>
        .multi-page-form .page {
            display: none;
        }
        .multi-page-form .page.active {
            display: block;
    }
    </style>
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="patientinfoModalLabel">Patient Record</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="multi-page-form"> 
                    <!-- Page 1 -->
                    <div class="page active" id="page1">
                        <div class="patient-info-section">
                            <h2 class="section-title">Patient Information Record</h2>
                            <div class="row mb-4">
                                <div class="col-md-6">
                                    <div class="row mb-3">
                                        <label class="col-sm-4 col-form-label">Last Name:</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control" name="last_name" value="{{ patient.last_name or '' }}" required>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <label class="col-sm-4 col-form-label">First Name:</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control" name="first_name" value="{{ patient.first_name or '' }}" required>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <label class="col-sm-4 col-form-label">Middle Initial:</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control" name="middle_name" value="{{ patient.middle_name or '' }}">
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <label class="col-sm-4 col-form-label">Birthdate:</label>
                                        <div class="col-sm-8">
                                            <input type="date" class="form-control" name="birthdate" value="{{ patient.birthdate or '' }}" required>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="row mb-3">
                                        <label class="col-sm-4 col-form-label">Date Today:</label>
                                        <div class="col-sm-8">
                                            <input type="date" class="form-control" value="{{ current_date }}" readonly>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <label class="col-sm-4 col-form-label">Age:</label>
                                        <div class="col-sm-8">
                                            <input type="number" class="form-control" value="{{ patient.age or '' }}" readonly>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <label class="col-sm-4 col-form-label">Sex:</label>
                                        <div class="col-sm-8">
                                            <div class="form-check form-check-inline">
                                                <input class="form-check-input" type="radio" name="sex" id="female" value="F"
                                                    {% if patient and patient.sex == 'F' %}checked{% endif %}>
                                                <label class="form-check-label" for="female">Female</label>
                                            </div>
                                            <div class="form-check form-check-inline">
                                                <input class="form-check-input" type="radio" name="sex" id="male" value="M"
                                                    {% if patient and patient.sex == 'M' %}checked{% endif %}>
                                                <label class="form-check-label" for="male">Male</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Address & Contact -->
                            <div class="row mb-4">
                                <div class="col-md-6">
                                    <div class="row mb-3">
                                        <label class="col-sm-4 col-form-label">Address Line 1:</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control" name="address_line1" value="{{ patient.address_line1 or '' }}" required>
                                        </div>
                                    </div>
                                    <div class="row mb-3 address-indent">
                                        <label class="col-sm-4 col-form-label">Barangay:</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control" name="baranggay" value="{{ patient.baranggay or '' }}" required>
                                        </div>
                                    </div>
                                    <div class="row mb-3 address-indent">
                                        <label class="col-sm-4 col-form-label">City:</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control" name="city" value="{{ patient.city or '' }}" required>
                                        </div>
                                    </div>
                                    <div class="row mb-3 address-indent">
                                        <label class="col-sm-4 col-form-label">Province:</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control" name="province" value="{{ patient.province or '' }}" required>
                                        </div>
                                    </div>
                                    <div class="row mb-3 address-indent">
                                        <label class="col-sm-4 col-form-label">Country:</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control" name="country" value="{{ patient.country or '' }}" required>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="row mb-3">
                                        <label class="col-sm-4 col-form-label">Occupation:</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control" name="occupation" value="{{ patient.occupation or '' }}">
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <label class="col-sm-4 col-form-label">Office No:</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control" name="office_number" value="{{ patient.office_number or '' }}">
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <label class="col-sm-4 col-form-label">Contact No:</label>
                                        <div class="col-sm-8">
                                            <input type="tel" class="form-control" name="contact_number" value="{{ patient.contact_number or '' }}" required>
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <label class="col-sm-4 col-form-label">Email:</label>
                                        <div class="col-sm-8">
                                            <input type="email" class="form-control" name="email" value="{{ patient.email or '' }}">
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <label class="col-sm-4 col-form-label">Referred By:</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control" name="reffered_by" value="{{ patient.reffered_by or '' }}">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Guardian Section -->
                            <div class="row mb-4">
                                <div class="col-md-6">
                                    <div class="row mb-3">
                                        <label class="col-sm-4 col-form-label">Guardian Name:</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control" name="guardian_full_name"
                                                value="{{ patient.guardian_full_name or '' }}" placeholder="For minors only">
                                        </div>
                                    </div>
                                    <div class="row mb-3">
                                        <label class="col-sm-4 col-form-label">Guardian Occupation:</label>
                                        <div class="col-sm-8">
                                            <input type="text" class="form-control" name="guardian_occupation" value="{{ patient.guardian_occupation or '' }}">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="row mb-3">
                                    <label class="col-sm-4 col-form-label">Initial Reason for Dental Consultation:</label>
                                    <div class="col-sm-8">
                                        <input type="text" class="form-control" name="initial_consultation_reason" value="{{ patient.initial_consultation_reason or '' }}">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <button type="button" class="btn btn-primary next-page">Next</button>
                        </div>
                    </div>

                    <!-- Page 2 -->
                    <div class="page" id="page2">
                        <h3 class="section-subtitle">Dental History</h3>
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="row mb-3">
                                    <label class="col-sm-4 col-form-label">Previous Dentist:</label>
                                    <div class="col-sm-8">
                                        <input type="text" class="form-control" name="previous_dentist" value="{{ patient.previous_dentist or '' }}">
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="row mb-3">
                                    <label class="col-sm-4 col-form-label">Last Dental Visit:</label>
                                    <div class="col-sm-8">
                                        <input type="date" class="form-control" name="last_dentist_visit" value="{{ patient.last_dentist_visit or '' }}">
                                    </div>
                                </div>
                            </div>
                        </div>
                         
                        <h3 class="section-subtitle">Medical History</h3>
                        <div class="row mb-4">
                            <div class="col-md-4">
                                <div class="row mb-3">
                                    <label class="col-sm-5 col-form-label">Physician's Name:</label>
                                    <div class="col-sm-7">
                                        <input type="text" class="form-control" name = "physician_name" value="{{ patient_medical_info.physician_name or '' }}">
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="row mb-3">
                                    <label class="col-sm-5 col-form-label">Specialty, if applicable:</label>
                                    <div class="col-sm-7">
                                        <input type="text" class="form-control" name = "physician_specialty" value="{{ patient_medical_info.physician_specialty or '' }}">
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="row mb-3">
                                    <label class="col-sm-5 col-form-label">Office Address:</label>
                                    <div class="col-sm-7">
                                        <input type="text" class="form-control" name = "office_address" value="{{ patient_medical_info.physician_office_address or '' }}">
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="row mb-3">
                                    <label class="col-sm-5 col-form-label">Office Number:</label>
                                    <div class="col-sm-7">
                                        <input type="text" class="form-control" name = "office_number" value="{{ patient_medical_info.physician_office_number or '' }}">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <ol class="medical-history-list">
                        <li>
                            Are you in good health?
                            <strong>{{ "No" if patient_medical_info.in_good_health == 0 else "Yes" }}</strong>
                        </li>
                        <li>
                            Are you under medical treatment now?
                            <div class="sub-question">
                                If so, what is the condition being treated?
                                <strong>{{ patient_medical_info.medical_treatment_currently_undergoing or "None" }}</strong>
                            </div>
                        </li>
                        <li>
                            Have you ever had serious illness or surgical operation?
                            <div class="sub-question">
                                What illness or operation? 
                                <strong>{{ patient_medical_info.recent_illness_or_surgical_operation or "None" }}</strong>
                            </div>
                            <div class="sub-question">
                                When was it? 
                                <strong>{{ patient_medical_info.when_illness_or__operation or "N/A" }}</strong>
                            </div>
                        </li>
                        <li>
                            Have you ever been hospitalized?
                            <div class="sub-question">
                                If so, when and why?
                                <strong>{{ patient_medical_info.when_why_hospitalized or "No" }}</strong>
                            </div>
                        </li>
                        <li>
                            Are you taking any prescription/non-prescription Medication?
                            <div class="sub-question">
                                If so, please specify:
                                <strong>{{ patient_medical_info.medications_currently_taking or "None" }}</strong>
                            </div>
                        </li>
                        <li>
                            Do you use tobacco products?
                            <strong>{{ "Yes" if patient_medical_info.using_tabacco else "No" }}</strong>
                        </li>
                        <li>
                            Do you use alcohol, cocaine or other dangerous drugs?
                            <strong>{{ "Yes" if patient_medical_info.using_alcohol_cocaine_drugs else "No" }}</strong>
                        </li>
                        {% set allergies = (patient_medical_info.allergies or "").split(",") %}
                            <li>
                                Are you allergic to any of the following:
                                <div class="checkbox-grid mt-2">
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="allergy1" name="allergy" {% if "Local Anesthetic" in allergies %}checked{% endif %}>
                                        <label for="allergy1">Local Anesthetic (ex. Lidocaine)</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="allergy2" name="allergy" {% if "Penicillin Antibiotics" in allergies %}checked{% endif %}>
                                        <label for="allergy2">Penicillin Antibiotics</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="allergy3" name="allergy" {% if "Latex" in allergies %}checked{% endif %}>
                                        <label for="allergy3">Latex</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="allergy4" name="allergy" {% if "Sulfa Drugs" in allergies %}checked{% endif %}>
                                        <label for="allergy4">Sulfa Drugs</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="allergy5" name="allergy" {% if "Aspirin" in allergies %}checked{% endif %}>
                                        <label for="allergy5">Aspirin</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="allergy6" name="allergy" {% if "Other" in allergies %}checked{% endif %}>
                                        <label for="allergy6">Other:</label>
                                        <input type="text" class="form-control form-control-sm d-inline-block w-auto ms-2"
                                            value="{{ allergies | reject('in', ['Local Anesthetic', 'Penicillin Antibiotics', 'Latex', 'Sulfa Drugs', 'Aspirin']) | join(', ') }}">
                                    </div>
                                </div>
                            </li>
                            <li>
                                Bleeding Time:
                                <strong>{{ patient_medical_info.bleeding_time }}</strong>
                                <div class="sub-question"></div>
                            </li>
                            <li>
                                For Women only
                                <div class="checkbox-grid mt-2">
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="women1" name="is_pregnant"
                                            {% if patient_medical_info.is_pregnant %}checked{% endif %}>
                                        <label for="women1">Are you pregnant?</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="women2" name="is_nursing"
                                            {% if patient_medical_info.is_nursing %}checked{% endif %}>
                                        <label for="women2">Are you nursing?</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="women3" name="on_birth_control"
                                            {% if patient_medical_info.on_birth_control %}checked{% endif %}>
                                        <label for="women3">Are you taking birth control pills?</label>
                                    </div>
                                </div>
                            </li>

                            <li>
                                Blood Type:
                                <strong>{{ patient_medical_info.blood_type }}</strong>
                                <div class="sub-question"></div>
                            </li>
                            <li>
                                Blood Pressure:
                                <strong>{{ patient_medical_info.blood_pressure }}</strong>
                                <div class="sub-question"></div>
                            </li>
                            {% set illnesses = patient_medical_info.illness_checklist.split(',') if patient_medical_info.illness_checklist else [] %}

                            <li>
                                Do you have or have had any of the following? Check which apply:
                                <div class="checkbox-grid mt-2">

                                    {% set known_conditions = [
                                        'AIDS', 'Anemia', 'Arthritis', 'Allergy', 'Angina Pectoris', 'Asthma', 'Blood Diseases',
                                        'Bruises', 'Chest Pain', 'Blood Pressure', 'Cancer', 'Circulatory Disturbances', 'Diabetes',
                                        'Drug Addiction', 'Fainting', 'Digestive', 'Epilepsy', 'Glaucoma', 'Headaches', 'Hepatitis',
                                        'Kidney', 'Heart Trouble', 'Hives', 'Liver', 'Lung Trouble', 'Operation', 'Radiation Therapy',
                                        'Nervousness', 'Pains', 'Rheumatic Fever', 'Scarlet Fever', 'Sickle Cell', 'Stomach Trouble',
                                        'Sexually Transmitted Diseases', 'Sinus Trouble', 'Stroke', 'Swollen Ankles', 'Tumor',
                                        'Venereal Disease', 'Thyroid Problem', 'Ulcer'
                                    ] %}

                                    {% set illnesses = patient_medical_info.illness_checklist.split(',') if patient_medical_info.illness_checklist else [] %}
                                    {% set other_conditions = [] %}

                                    {# Render checkboxes for known conditions #}
                                    {% for cond in known_conditions %}
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="condition{{ loop.index }}" name="condition" value="{{ cond }}"
                                            {% if cond in illnesses %}checked{% endif %}>
                                        <label for="condition{{ loop.index }}">{{ cond }}</label>
                                    </div>
                                    {% endfor %}

                                    {# Collect unknown conditions as "Other" #}
                                    {% for item in illnesses %}
                                        {% if item not in known_conditions %}
                                            {% set _ = other_conditions.append(item.strip()) %}
                                        {% endif %}
                                    {% endfor %}

                                    {# Display Other field #}
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="conditionOther" name="condition" value="Other"
                                            {% if other_conditions %}checked{% endif %}>
                                        <label for="conditionOther">Other:</label>
                                        <input type="text" class="form-control form-control-sm d-inline-block w-auto ms-2"
                                            name="other_condition" value="{{ other_conditions | join(', ') }}">
                                    </div>
                                </div>
                            </li>
                        </ol>
                        
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary prev-page">Previous</button>
                            <button type="button" class="btn btn-primary next-page">Next</button>
                        </div>
                    </div>

                    <!-- Page 3 -->
                    <div class="page" id="page3">
                        <div class="dental_chart">
                            <select name="chart" class="chart-select">
                                <option value="adult">Adult Chart</option>
                                <option value="child">Children Chart</option>
                            </select>
                            <img id="dentalImage" src="{{ url_for('static', filename='uploads/patient_records/dental_chart/11.png') }}" alt="Dental Diagram" width="100%" height="100%">
                            {% for record in dental_record %}
                            <div class="dental-record-entry mb-5">
                                <div class="dental-record-section">
                                    <!-- Periodontal Screening -->
                                    <h5 class="dental-record-section-title">Periodontal Screening:</h5>
                                    <div class="form-check form-check-inline">
                                        <input type="checkbox" id="gingivitis_{{ record.dental_record_id }}" class="form-check-input" disabled {{ 'checked' if 'Gingivitis' in record.periodontal_screening else '' }}>
                                        <label for="gingivitis_{{ record.dental_record_id }}">Gingivitis</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input type="checkbox" id="early_{{ record.dental_record_id }}" class="form-check-input" disabled {{ 'checked' if 'Early Periodontitis' in record.periodontal_screening else '' }}>
                                        <label for="early_{{ record.dental_record_id }}">Early Periodontitis</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input type="checkbox" id="moderate_{{ record.dental_record_id }}" class="form-check-input" disabled {{ 'checked' if 'Moderate' in record.periodontal_screening else '' }}>
                                        <label for="moderate_{{ record.dental_record_id }}">Moderate</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input type="checkbox" id="periodontitis_{{ record.dental_record_id }}" class="form-check-input" disabled {{ 'checked' if 'Periodontitis' in record.periodontal_screening else '' }}>
                                        <label for="periodontitis_{{ record.dental_record_id }}">Periodontitis</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input type="checkbox" id="advanced_{{ record.dental_record_id }}" class="form-check-input" disabled {{ 'checked' if 'Advanced Periodontitis' in record.periodontal_screening else '' }}>
                                        <label for="advanced_{{ record.dental_record_id }}">Advanced Periodontitis</label>
                                    </div>

                                    <!-- Occlusion -->
                                    <h5 class="dental-record-section-title mt-4">Occlusion:</h5>
                                    <div class="form-check form-check-inline">
                                        <input type="checkbox" id="class_{{ record.dental_record_id }}" class="form-check-input" disabled {{ 'checked' if 'Class' in record.occlusion else '' }}>
                                        <label for="class_{{ record.dental_record_id }}">Class (Molar)</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input type="checkbox" id="overjet_{{ record.dental_record_id }}" class="form-check-input" disabled {{ 'checked' if 'Overjet' in record.occlusion else '' }}>
                                        <label for="overjet_{{ record.dental_record_id }}">Overjet Overbite</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input type="checkbox" id="midline_{{ record.dental_record_id }}" class="form-check-input" disabled {{ 'checked' if 'Midline' in record.occlusion else '' }}>
                                        <label for="midline_{{ record.dental_record_id }}">Midline Deviation</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input type="checkbox" id="crossbite_{{ record.dental_record_id }}" class="form-check-input" disabled {{ 'checked' if 'Crossbite' in record.occlusion else '' }}>
                                        <label for="crossbite_{{ record.dental_record_id }}">Crossbite</label>
                                    </div>

                                    <!-- Appliances -->
                                    <h5 class="dental-record-section-title mt-4">Appliances:</h5>
                                    <div class="form-check form-check-inline">
                                        <input type="checkbox" id="ortho_{{ record.dental_record_id }}" class="form-check-input" disabled {{ 'checked' if 'Orthodontic' in record.appliances else '' }}>
                                        <label for="ortho_{{ record.dental_record_id }}">Orthodontic</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input type="checkbox" id="stayplate_{{ record.dental_record_id }}" class="form-check-input" disabled {{ 'checked' if 'Stayplate' in record.appliances else '' }}>
                                        <label for="stayplate_{{ record.dental_record_id }}">Stayplate</label>
                                    </div>
                                    <label class="ms-3">Others:</label>
                                    <input type="text" class="form-control form-info-control d-inline-block w-auto" readonly value="{% if record.appliances not in ['Orthodontic', 'Stayplate'] %}{{ record.appliances }}{% endif %}">

                                    <!-- TMD -->
                                    <h5 class="dental-record-section-title mt-4">TMD:</h5>
                                    <div class="form-check form-check-inline">
                                        <input type="checkbox" id="clenching_{{ record.dental_record_id }}" class="form-check-input" disabled {{ 'checked' if 'Clenching' in record.TMD else '' }}>
                                        <label for="clenching_{{ record.dental_record_id }}">Clenching</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input type="checkbox" id="clicking_{{ record.dental_record_id }}" class="form-check-input" disabled {{ 'checked' if 'Clicking' in record.TMD else '' }}>
                                        <label for="clicking_{{ record.dental_record_id }}">Clicking</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input type="checkbox" id="trismus_{{ record.dental_record_id }}" class="form-check-input" disabled {{ 'checked' if 'Trismus' in record.TMD else '' }}>
                                        <label for="trismus_{{ record.dental_record_id }}">Trismus</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input type="checkbox" id="muscle_{{ record.dental_record_id }}" class="form-check-input" disabled {{ 'checked' if 'Muscle Spasm' in record.TMD else '' }}>
                                        <label for="muscle_{{ record.dental_record_id }}">Muscle Spasm</label>
                                    </div>
                                </div>
                            </div>
                            <hr>
                            {% endfor %} 
                        </div>
                        
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary prev-page">Previous</button>
                            <button type="button" class="btn-submit">Submit</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>




<script>
document.addEventListener('DOMContentLoaded', function() {
    // Navigation between pages
    const pages = document.querySelectorAll('.page');
    let currentPage = 0;
    
    // Show first page initially
    pages[currentPage].classList.add('active');
    
    // Next button click handler
    document.querySelectorAll('.next-page').forEach(button => {
        button.addEventListener('click', function() {
            if (currentPage < pages.length - 1) {
                pages[currentPage].classList.remove('active');
                currentPage++;
                pages[currentPage].classList.add('active');
            }
        });
    });
    
    // Previous button click handler
    document.querySelectorAll('.prev-page').forEach(button => {
        button.addEventListener('click', function() {
            if (currentPage > 0) {
                pages[currentPage].classList.remove('active');
                currentPage--;
                pages[currentPage].classList.add('active');
            }
        });
    });
});
</script>
</div>